<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Parametric Engine - SENSIBLE VERSION</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap');
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            background: #000;
            color: #fff;
            font-family: 'Orbitron', monospace;
            min-height: 100vh;
            background: radial-gradient(ellipse at center, #1a0033 0%, #000000 70%);
        }
        
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid #00ffff;
            padding: 15px 30px;
        }
        
        .header h1 {
            color: #00ffff;
            font-size: 1.3rem;
            text-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
        }
        
        .header-controls {
            display: flex;
            gap: 15px;
            margin-top: 10px;
            flex-wrap: wrap;
        }
        
        .btn {
            background: rgba(0, 255, 255, 0.2);
            border: 1px solid #00ffff;
            color: #00ffff;
            padding: 8px 16px;
            border-radius: 15px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Orbitron', monospace;
            font-weight: bold;
        }
        
        .btn:hover {
            background: rgba(0, 255, 255, 0.4);
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
        }
        
        .btn-primary {
            background: linear-gradient(45deg, #00ffff, #ff00ff);
            color: #000;
            border: none;
        }
        
        .btn-secondary {
            background: rgba(255, 150, 0, 0.2);
            border-color: #ff9600;
            color: #ff9600;
        }
        
        .btn-danger {
            background: rgba(255, 50, 50, 0.2);
            border-color: #ff3232;
            color: #ff3232;
        }
        
        .main-container {
            display: grid;
            grid-template-columns: 350px 1fr 300px;
            height: 100vh;
            margin-top: 80px;
            gap: 20px;
            padding: 20px;
        }
        
        .control-panel {
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 15px;
            padding: 20px;
            overflow-y: auto;
            max-height: calc(100vh - 120px);
        }
        
        .control-section {
            margin-bottom: 25px;
        }
        
        .section-title {
            color: #00ffff;
            font-size: 0.9rem;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .parameter-control {
            margin-bottom: 20px;
        }
        
        .param-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.8);
        }
        
        .param-value {
            color: #00ffff;
            font-weight: bold;
        }
        
        .param-slider {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            outline: none;
            -webkit-appearance: none;
            cursor: pointer;
        }
        
        .param-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 16px;
            height: 16px;
            background: #00ffff;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
        }
        
        .geometry-selector {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-bottom: 15px;
        }
        
        .geometry-btn {
            background: rgba(0, 255, 255, 0.1);
            border: 1px solid rgba(0, 255, 255, 0.3);
            color: rgba(255, 255, 255, 0.7);
            padding: 8px;
            border-radius: 8px;
            font-size: 0.6rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }
        
        .geometry-btn.active {
            background: rgba(0, 255, 255, 0.3);
            border-color: #00ffff;
            color: #00ffff;
        }
        
        .preview-panel {
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 15px;
            position: relative;
            overflow: hidden;
        }
        
        .preview-canvas {
            width: 100%;
            height: 100%;
            display: block;
        }
        
        .preview-overlay {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid rgba(0, 255, 255, 0.3);
        }
        
        .current-variant {
            color: #00ffff;
            font-size: 1.1rem;
            margin-bottom: 5px;
        }
        
        .variant-stats {
            font-size: 0.7rem;
            color: rgba(255, 255, 255, 0.6);
        }
        
        .generation-panel {
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 15px;
            padding: 20px;
            overflow-y: auto;
            max-height: calc(100vh - 120px);
        }
        
        .generation-section {
            margin-bottom: 25px;
        }
        
        .mode-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .mode-btn {
            flex: 1;
            padding: 10px;
            border-radius: 8px;
            font-size: 0.7rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            border: 1px solid rgba(0, 255, 255, 0.3);
            background: rgba(0, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.7);
        }
        
        .mode-btn.active {
            background: rgba(0, 255, 255, 0.3);
            border-color: #00ffff;
            color: #00ffff;
        }
        
        .batch-controls {
            display: none;
        }
        
        .batch-controls.active {
            display: block;
        }
        
        .generate-btn {
            width: 100%;
            background: linear-gradient(45deg, #00ffff, #ff00ff);
            border: none;
            color: #000;
            padding: 12px;
            border-radius: 10px;
            font-family: 'Orbitron', monospace;
            font-weight: bold;
            cursor: pointer;
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }
        
        .generate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 255, 255, 0.3);
        }
        
        .preset-list {
            max-height: 150px;
            overflow-y: auto;
        }
        
        .preset-item {
            background: rgba(0, 255, 255, 0.1);
            padding: 8px;
            margin-bottom: 5px;
            border-radius: 5px;
            font-size: 0.7rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .preset-item:hover {
            background: rgba(0, 255, 255, 0.2);
        }
        
        @media (max-width: 1200px) {
            .main-container {
                grid-template-columns: 300px 1fr 250px;
            }
        }
        
        @media (max-width: 900px) {
            .main-container {
                grid-template-columns: 1fr;
                grid-template-rows: auto 400px auto;
            }
            
            .control-panel, .generation-panel {
                max-height: none;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>‚öôÔ∏è Parametric Engine - SENSIBLE VERSION</h1>
        <div class="header-controls">
            <button class="btn btn-secondary" onclick="window.open('gallery-FIXED.html', '_blank')">üåå GALLERY</button>
            <button class="btn btn-primary" onclick="saveAndLaunch()">üöÄ SAVE & LAUNCH</button>
            <button class="btn" onclick="exportVariation()">üì§ EXPORT</button>
            <button class="btn" onclick="importVariation()">üì• IMPORT</button>
            <button class="btn" onclick="savePreset()">üíæ SAVE PRESET</button>
            <button class="btn" onclick="shareURL()">üîó SHARE URL</button>
            <button class="btn btn-danger" onclick="clearMyCustoms()">üóëÔ∏è CLEAR MY CUSTOMS</button>
        </div>
    </div>
    
    <div class="main-container">
        <!-- LEFT PANEL - PARAMETER CONTROLS -->
        <div class="control-panel">
            <!-- GEOMETRY SELECTION -->
            <div class="control-section">
                <div class="section-title">Base Geometry</div>
                <div class="geometry-selector">
                    <div class="geometry-btn active" data-geometry="0">TETRAHEDRON</div>
                    <div class="geometry-btn" data-geometry="1">HYPERCUBE</div>
                    <div class="geometry-btn" data-geometry="2">SPHERE</div>
                    <div class="geometry-btn" data-geometry="3">TORUS</div>
                    <div class="geometry-btn" data-geometry="4">KLEIN</div>
                    <div class="geometry-btn" data-geometry="5">FRACTAL</div>
                    <div class="geometry-btn" data-geometry="6">WAVE</div>
                    <div class="geometry-btn" data-geometry="7">CRYSTAL</div>
                </div>
            </div>
            
            <!-- CORE PARAMETERS - EXPANDED RANGES -->
            <div class="control-section">
                <div class="section-title">Core Parameters</div>
                
                <div class="parameter-control">
                    <div class="param-label">
                        <span>Density</span>
                        <span class="param-value" id="densityValue">1.0</span>
                    </div>
                    <input type="range" class="param-slider" id="densitySlider" min="0.1" max="5.0" step="0.1" value="1.0">
                    <div style="font-size: 0.6rem; color: rgba(255,255,255,0.4); margin-top: 3px;">0.1 ‚Üí 5.0 (High sensitivity)</div>
                </div>
                
                <div class="parameter-control">
                    <div class="param-label">
                        <span>Speed</span>
                        <span class="param-value" id="speedValue">0.5</span>
                    </div>
                    <input type="range" class="param-slider" id="speedSlider" min="0.05" max="3.0" step="0.05" value="0.5">
                    <div style="font-size: 0.6rem; color: rgba(255,255,255,0.4); margin-top: 3px;">0.05 ‚Üí 3.0 (High sensitivity)</div>
                </div>
                
                <div class="parameter-control">
                    <div class="param-label">
                        <span>Chaos</span>
                        <span class="param-value" id="chaosValue">0.0</span>
                    </div>
                    <input type="range" class="param-slider" id="chaosSlider" min="0.0" max="2.0" step="0.02" value="0.0">
                    <div style="font-size: 0.6rem; color: rgba(255,255,255,0.4); margin-top: 3px;">0.0 ‚Üí 2.0 (High sensitivity)</div>
                </div>
                
                <div class="parameter-control">
                    <div class="param-label">
                        <span>Morphing</span>
                        <span class="param-value" id="morphValue">0.0</span>
                    </div>
                    <input type="range" class="param-slider" id="morphSlider" min="0.0" max="2.0" step="0.02" value="0.0">
                    <div style="font-size: 0.6rem; color: rgba(255,255,255,0.4); margin-top: 3px;">0.0 ‚Üí 2.0 (High sensitivity)</div>
                </div>
            </div>
            
            <!-- COLOR SYSTEM -->
            <div class="control-section">
                <div class="section-title">Color System</div>
                
                <div class="parameter-control">
                    <div class="param-label">
                        <span>Hue Shift</span>
                        <span class="param-value" id="hueValue">0¬∞</span>
                    </div>
                    <input type="range" class="param-slider" id="hueSlider" min="0" max="360" step="5" value="0">
                    <div style="font-size: 0.6rem; color: rgba(255,255,255,0.4); margin-top: 3px;">0¬∞ ‚Üí 360¬∞ (5¬∞ steps)</div>
                </div>
                
                <div class="parameter-control">
                    <div class="param-label">
                        <span>Saturation</span>
                        <span class="param-value" id="saturationValue">0.8</span>
                    </div>
                    <input type="range" class="param-slider" id="saturationSlider" min="0.0" max="1.0" step="0.01" value="0.8">
                    <div style="font-size: 0.6rem; color: rgba(255,255,255,0.4); margin-top: 3px;">0.0 ‚Üí 1.0 (High sensitivity)</div>
                </div>
                
                <div class="parameter-control">
                    <div class="param-label">
                        <span>Intensity</span>
                        <span class="param-value" id="intensityValue">0.5</span>
                    </div>
                    <input type="range" class="param-slider" id="intensitySlider" min="0.05" max="1.0" step="0.01" value="0.5">
                    <div style="font-size: 0.6rem; color: rgba(255,255,255,0.4); margin-top: 3px;">0.05 ‚Üí 1.0 (High sensitivity)</div>
                </div>
            </div>
            
            <!-- AUDIO REACTIVITY -->
            <div class="control-section">
                <div class="section-title">Audio Reactivity</div>
                
                <div class="parameter-control">
                    <div class="param-label">
                        <span>Bass Response</span>
                        <span class="param-value" id="bassValue">1.0</span>
                    </div>
                    <input type="range" class="param-slider" id="bassSlider" min="0.0" max="3.0" step="0.05" value="1.0">
                    <div style="font-size: 0.6rem; color: rgba(255,255,255,0.4); margin-top: 3px;">0.0 ‚Üí 3.0 (High sensitivity)</div>
                </div>
                
                <div class="parameter-control">
                    <div class="param-label">
                        <span>Mid Response</span>
                        <span class="param-value" id="midValue">1.0</span>
                    </div>
                    <input type="range" class="param-slider" id="midSlider" min="0.0" max="3.0" step="0.05" value="1.0">
                    <div style="font-size: 0.6rem; color: rgba(255,255,255,0.4); margin-top: 3px;">0.0 ‚Üí 3.0 (High sensitivity)</div>
                </div>
                
                <div class="parameter-control">
                    <div class="param-label">
                        <span>High Response</span>
                        <span class="param-value" id="highValue">1.0</span>
                    </div>
                    <input type="range" class="param-slider" id="highSlider" min="0.0" max="3.0" step="0.05" value="1.0">
                    <div style="font-size: 0.6rem; color: rgba(255,255,255,0.4); margin-top: 3px;">0.0 ‚Üí 3.0 (High sensitivity)</div>
                </div>
            </div>
        </div>
        
        <!-- CENTER PANEL - LIVE PREVIEW -->
        <div class="preview-panel">
            <iframe class="preview-canvas" id="previewIframe" 
                    src="demo-modular.html?hideui=true&noaudio=true&geometry=0&density=1.0&speed=0.5&chaos=0.0&morph=0.0&hue=0&saturation=0.8&intensity=0.5"
                    style="border: none; width: 100%; height: 100%; background: #000;"></iframe>
            <div class="preview-overlay">
                <div class="current-variant" id="currentVariant">CUSTOM VARIATION</div>
                <div class="variant-stats" id="variantStats">
                    Geometry: TETRAHEDRON ‚Ä¢ Complexity: ‚òÖ‚òÖ‚òÜ‚òÜ‚òÜ
                </div>
            </div>
        </div>
        
        <!-- RIGHT PANEL - GENERATION TOOLS -->
        <div class="generation-panel">
            <!-- MODE SELECTOR -->
            <div class="generation-section">
                <div class="section-title">Generation Mode</div>
                <div class="mode-selector">
                    <div class="mode-btn active" data-mode="single" onclick="switchMode('single')">
                        SINGLE<br><small>Save one at a time</small>
                    </div>
                    <div class="mode-btn" data-mode="batch" onclick="switchMode('batch')">
                        BATCH<br><small>Generate series</small>
                    </div>
                </div>
            </div>
            
            <!-- SINGLE MODE (DEFAULT) -->
            <div class="generation-section" id="singleMode">
                <div class="section-title">Single Mode Actions</div>
                <button class="generate-btn" onclick="saveAndLaunch()" style="background: linear-gradient(45deg, #00ff00, #00ffff);">üöÄ SAVE & LAUNCH</button>
                <button class="generate-btn" onclick="saveCurrentVariation()" style="background: linear-gradient(45deg, #ff9600, #ffcc00);">üíæ SAVE TO MY CUSTOMS</button>
                <button class="generate-btn" onclick="randomizeAll()" style="background: linear-gradient(45deg, #ff00ff, #ff6666);">üé≤ RANDOMIZE ALL</button>
                <div style="font-size: 0.7rem; color: rgba(255,255,255,0.6); margin-top: 10px; text-align: center;">
                    <strong>Simple mode:</strong> Adjust parameters, save one variation at a time
                </div>
            </div>
            
            <!-- BATCH MODE -->
            <div class="batch-controls" id="batchMode">
                <div class="generation-section">
                    <div class="section-title">Batch Generation</div>
                    <button class="generate-btn" onclick="generateDensitySeries()">DENSITY SERIES (5x)</button>
                    <button class="generate-btn" onclick="generateSpeedSeries()">SPEED SERIES (5x)</button>
                    <button class="generate-btn" onclick="generateChaosSeries()">CHAOS SERIES (5x)</button>
                    <button class="generate-btn" onclick="generateColorSeries()">COLOR SERIES (6x)</button>
                    <button class="generate-btn" onclick="generateHybridSeries()">HYBRID SERIES (4x)</button>
                    <button class="generate-btn" onclick="generateRandomSet()">RANDOM SET (10x)</button>
                    <div style="font-size: 0.7rem; color: rgba(255,255,255,0.6); margin-top: 10px; text-align: center;">
                        <strong>Batch mode:</strong> Generate multiple variations at once
                    </div>
                </div>
            </div>
            
            <!-- PRESET MANAGEMENT -->
            <div class="generation-section">
                <div class="section-title">Saved Presets</div>
                <div class="preset-list" id="presetList">
                    <div class="preset-item" onclick="loadPreset('default')">Default Settings</div>
                </div>
            </div>
            
            <!-- STATISTICS -->
            <div class="generation-section">
                <div class="section-title">Your Custom Statistics</div>
                <div class="variant-stats">
                    <div style="font-size: 0.7rem; color: rgba(255,255,255,0.6); margin-bottom: 5px;">
                        Your Customs: <span id="customCount">0</span> variations<br>
                        Base Collections: <span id="baseCount">91</span> variations<br>
                        Total Available: <span id="totalCount">91</span> variations
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        class SensibleParametricEngine {
            constructor() {
                this.currentParams = {
                    geometry: 0,
                    density: 1.0,
                    speed: 0.5,
                    chaos: 0.0,
                    morph: 0.0,
                    hue: 0,
                    saturation: 0.8,
                    intensity: 0.5,
                    bassResponse: 1.0,
                    midResponse: 1.0,
                    highResponse: 1.0
                };
                
                this.geometryNames = [
                    'TETRAHEDRON', 'HYPERCUBE', 'SPHERE', 'TORUS',
                    'KLEIN BOTTLE', 'FRACTAL', 'WAVE', 'CRYSTAL'
                ];
                
                this.generatedVariations = [];
                this.presets = this.loadPresets();
                this.currentMode = 'single';
                
                this.init();
            }
            
            init() {
                this.setupControls();
                this.setupPreview();
                this.updateDisplay();
                this.updateCustomCount();
            }
            
            setupControls() {
                // Geometry selection
                document.querySelectorAll('.geometry-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        document.querySelectorAll('.geometry-btn').forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');
                        this.currentParams.geometry = parseInt(btn.dataset.geometry);
                        this.updateDisplay();
                    });
                });
                
                // Parameter sliders
                this.setupSlider('density', 'densityValue', 'densitySlider');
                this.setupSlider('speed', 'speedValue', 'speedSlider');
                this.setupSlider('chaos', 'chaosValue', 'chaosSlider');
                this.setupSlider('morph', 'morphValue', 'morphSlider');
                this.setupSlider('hue', 'hueValue', 'hueSlider', '¬∞');
                this.setupSlider('saturation', 'saturationValue', 'saturationSlider');
                this.setupSlider('intensity', 'intensityValue', 'intensitySlider');
                this.setupSlider('bassResponse', 'bassValue', 'bassSlider');
                this.setupSlider('midResponse', 'midValue', 'midSlider');
                this.setupSlider('highResponse', 'highValue', 'highSlider');
            }
            
            setupSlider(param, valueId, sliderId, suffix = '') {
                const slider = document.getElementById(sliderId);
                const valueDisplay = document.getElementById(valueId);
                
                slider.addEventListener('input', (e) => {
                    const value = parseFloat(e.target.value);
                    this.currentParams[param] = value;
                    valueDisplay.textContent = value + suffix;
                    this.updateDisplay();
                });
            }
            
            setupPreview() {
                this.previewIframe = document.getElementById('previewIframe');
                this.updatePreview();
            }
            
            updateDisplay() {
                const geometryName = this.geometryNames[this.currentParams.geometry];
                const complexity = this.calculateComplexity();
                
                document.getElementById('currentVariant').textContent = 
                    `CUSTOM ${geometryName}`;
                    
                document.getElementById('variantStats').innerHTML = 
                    `Geometry: ${geometryName} ‚Ä¢ Complexity: ${'‚òÖ'.repeat(complexity)}${'‚òÜ'.repeat(5-complexity)}`;
                
                this.updatePreview();
            }
            
            updatePreview() {
                const params = new URLSearchParams();
                params.set('hideui', 'true');
                params.set('noaudio', 'true');
                Object.keys(this.currentParams).forEach(key => {
                    params.set(key, this.currentParams[key]);
                });
                
                const newSrc = `demo-modular.html?${params.toString()}`;
                if (this.previewIframe && this.previewIframe.src !== newSrc) {
                    this.previewIframe.src = newSrc;
                }
            }
            
            calculateComplexity(variation) {
                if (!variation) variation = this.currentParams;
                const { density, speed, chaos, morph } = variation;
                const complexityScore = (density + speed + chaos * 2 + morph * 2) / 8;
                return Math.min(5, Math.max(1, Math.round(complexityScore * 5)));
            }
            
            // SENSIBLE SAVE FUNCTION
            saveCurrentVariation() {
                const name = prompt('Enter name for this variation:', `${this.geometryNames[this.currentParams.geometry]} Custom`);
                if (!name) return;
                
                // Get existing custom variations
                const existing = this.getCustomVariations();
                
                // Add new variation
                const newVariation = {
                    name: name,
                    params: {...this.currentParams}
                };
                
                existing.variations.push(newVariation);
                
                // Save back to localStorage
                localStorage.setItem('customHolographicVariations', JSON.stringify(existing));
                
                alert(`‚úÖ Saved "${name}" to your custom variations!`);
                this.updateCustomCount();
            }
            
            getCustomVariations() {
                const stored = localStorage.getItem('customHolographicVariations');
                if (stored) {
                    return JSON.parse(stored);
                } else {
                    return {
                        version: "1.0",
                        timestamp: new Date().toISOString(),
                        profileName: "My Custom Variations",
                        variations: []
                    };
                }
            }
            
            updateCustomCount() {
                const custom = this.getCustomVariations();
                const count = custom.variations.length;
                document.getElementById('customCount').textContent = count;
                document.getElementById('totalCount').textContent = 91 + count;
            }
            
            // CLEAR CUSTOMS FUNCTION
            clearMyCustoms() {
                if (confirm('‚ö†Ô∏è This will delete ALL your custom variations! Are you sure?')) {
                    localStorage.removeItem('customHolographicVariations');
                    alert('üóëÔ∏è All custom variations cleared!');
                    this.updateCustomCount();
                }
            }
            
            // SAVE AND LAUNCH
            saveAndLaunch() {
                // Save current parameters
                this.saveCurrentVariation();
                
                // Launch fullscreen
                const params = new URLSearchParams();
                Object.keys(this.currentParams).forEach(key => {
                    params.set(key, this.currentParams[key]);
                });
                
                const url = `demo-modular.html?${params.toString()}&autoplay=true`;
                window.open(url, '_blank');
            }
            
            // RANDOMIZE FUNCTION
            randomizeAll() {
                this.currentParams = {
                    geometry: Math.floor(Math.random() * 8),
                    density: 0.1 + Math.random() * 4.9,
                    speed: 0.05 + Math.random() * 2.95,
                    chaos: Math.random() * 2.0,
                    morph: Math.random() * 2.0,
                    hue: Math.floor(Math.random() * 72) * 5, // 5-degree steps
                    saturation: 0.3 + Math.random() * 0.7,
                    intensity: 0.05 + Math.random() * 0.95,
                    bassResponse: Math.random() * 3.0,
                    midResponse: Math.random() * 3.0,
                    highResponse: Math.random() * 3.0
                };
                
                this.syncControlsWithParams();
                this.updateDisplay();
            }
            
            syncControlsWithParams() {
                // Update all sliders and geometry selection
                Object.keys(this.currentParams).forEach(param => {
                    const slider = document.getElementById(param + 'Slider');
                    if (slider) {
                        slider.value = this.currentParams[param];
                        const valueDisplay = document.getElementById(param + 'Value');
                        if (valueDisplay) {
                            const suffix = param === 'hue' ? '¬∞' : '';
                            valueDisplay.textContent = this.currentParams[param] + suffix;
                        }
                    }
                });
                
                // Update geometry selection
                document.querySelectorAll('.geometry-btn').forEach((btn, index) => {
                    btn.classList.toggle('active', index === this.currentParams.geometry);
                });
            }
            
            // BATCH GENERATION (only when in batch mode)
            generateDensitySeries() {
                if (this.currentMode !== 'batch') return;
                const baseName = this.geometryNames[this.currentParams.geometry];
                const densityLevels = [0.5, 1.0, 2.0, 3.0, 4.0];
                
                densityLevels.forEach((density, index) => {
                    const variation = {
                        name: `${baseName} DENSITY ${index + 1}`,
                        params: {...this.currentParams, density: density}
                    };
                    this.addToBatch(variation);
                });
            }
            
            generateSpeedSeries() {
                if (this.currentMode !== 'batch') return;
                const baseName = this.geometryNames[this.currentParams.geometry];
                const speedLevels = [0.1, 0.5, 1.0, 2.0, 3.0];
                
                speedLevels.forEach((speed, index) => {
                    const variation = {
                        name: `${baseName} SPEED ${index + 1}`,
                        params: {...this.currentParams, speed: speed}
                    };
                    this.addToBatch(variation);
                });
            }
            
            generateChaosSeries() {
                if (this.currentMode !== 'batch') return;
                const baseName = this.geometryNames[this.currentParams.geometry];
                const chaosLevels = [0.0, 0.5, 1.0, 1.5, 2.0];
                
                chaosLevels.forEach((chaos, index) => {
                    const variation = {
                        name: `${baseName} CHAOS ${index + 1}`,
                        params: {...this.currentParams, chaos: chaos}
                    };
                    this.addToBatch(variation);
                });
            }
            
            generateColorSeries() {
                if (this.currentMode !== 'batch') return;
                const baseName = this.geometryNames[this.currentParams.geometry];
                const hueShifts = [0, 60, 120, 180, 240, 300];
                
                hueShifts.forEach((hue, index) => {
                    const variation = {
                        name: `${baseName} HUE ${hue}¬∞`,
                        params: {...this.currentParams, hue: hue}
                    };
                    this.addToBatch(variation);
                });
            }
            
            generateHybridSeries() {
                if (this.currentMode !== 'batch') return;
                const currentGeom = this.currentParams.geometry;
                const baseName = this.geometryNames[currentGeom];
                
                for (let i = 1; i <= 4; i++) {
                    const hybridGeom = (currentGeom + i) % 8;
                    const hybridName = this.geometryNames[hybridGeom];
                    
                    const variation = {
                        name: `${baseName}-${hybridName} HYBRID`,
                        params: {...this.currentParams, geometry: hybridGeom, morph: 0.5 + i * 0.2}
                    };
                    this.addToBatch(variation);
                }
            }
            
            generateRandomSet() {
                if (this.currentMode !== 'batch') return;
                const baseName = this.geometryNames[this.currentParams.geometry];
                
                for (let i = 0; i < 10; i++) {
                    const variation = {
                        name: `${baseName} RANDOM ${i + 1}`,
                        params: {
                            ...this.currentParams,
                            density: 0.1 + Math.random() * 4.9,
                            speed: 0.05 + Math.random() * 2.95,
                            chaos: Math.random() * 2.0,
                            morph: Math.random() * 2.0,
                            hue: Math.floor(Math.random() * 72) * 5,
                            saturation: 0.3 + Math.random() * 0.7,
                            intensity: 0.05 + Math.random() * 0.95
                        }
                    };
                    this.addToBatch(variation);
                }
            }
            
            addToBatch(variation) {
                this.generatedVariations.push(variation);
                alert(`Added "${variation.name}" to batch queue (${this.generatedVariations.length} total)`);
            }
            
            // PRESET SYSTEM
            savePreset() {
                const name = prompt('Enter preset name:');
                if (name) {
                    this.presets[name] = {...this.currentParams};
                    this.savePresetsToStorage();
                    this.updatePresetList();
                }
            }
            
            loadPreset(name) {
                if (this.presets[name]) {
                    this.currentParams = {...this.presets[name]};
                    this.syncControlsWithParams();
                    this.updateDisplay();
                }
            }
            
            updatePresetList() {
                const list = document.getElementById('presetList');
                list.innerHTML = '';
                
                Object.keys(this.presets).forEach(name => {
                    const item = document.createElement('div');
                    item.className = 'preset-item';
                    item.textContent = name;
                    item.onclick = () => this.loadPreset(name);
                    list.appendChild(item);
                });
            }
            
            loadPresets() {
                const saved = localStorage.getItem('holographic-presets');
                return saved ? JSON.parse(saved) : {
                    'Default': {...this.currentParams}
                };
            }
            
            savePresetsToStorage() {
                localStorage.setItem('holographic-presets', JSON.stringify(this.presets));
            }
            
            // EXPORT/IMPORT
            exportVariation() {
                const data = {
                    version: '1.0',
                    type: 'holographic-variation',
                    params: this.currentParams,
                    generated: new Date().toISOString()
                };
                
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `holographic-variation-${Date.now()}.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
            }
            
            importVariation() {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.json';
                input.onchange = (e) => {
                    const file = e.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            try {
                                const data = JSON.parse(e.target.result);
                                if (data.type === 'holographic-variation') {
                                    this.currentParams = {...data.params};
                                    this.syncControlsWithParams();
                                    this.updateDisplay();
                                }
                            } catch (error) {
                                alert('Invalid file format');
                            }
                        };
                        reader.readAsText(file);
                    }
                };
                input.click();
            }
            
            shareURL() {
                const params = new URLSearchParams();
                Object.keys(this.currentParams).forEach(key => {
                    params.set(key, this.currentParams[key]);
                });
                
                const url = `${window.location.origin}${window.location.pathname}?${params.toString()}`;
                navigator.clipboard.writeText(url).then(() => {
                    alert('URL copied to clipboard!');
                });
            }
        }
        
        // GLOBAL FUNCTIONS
        let engine;
        
        function switchMode(mode) {
            engine.currentMode = mode;
            
            // Update mode buttons
            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-mode="${mode}"]`).classList.add('active');
            
            // Show/hide appropriate controls
            document.getElementById('singleMode').style.display = mode === 'single' ? 'block' : 'none';
            document.getElementById('batchMode').style.display = mode === 'batch' ? 'block' : 'none';
        }
        
        function saveAndLaunch() { engine.saveAndLaunch(); }
        function saveCurrentVariation() { engine.saveCurrentVariation(); }
        function randomizeAll() { engine.randomizeAll(); }
        function clearMyCustoms() { engine.clearMyCustoms(); }
        
        function exportVariation() { engine.exportVariation(); }
        function importVariation() { engine.importVariation(); }
        function savePreset() { engine.savePreset(); }
        function shareURL() { engine.shareURL(); }
        
        function generateDensitySeries() { engine.generateDensitySeries(); }
        function generateSpeedSeries() { engine.generateSpeedSeries(); }
        function generateChaosSeries() { engine.generateChaosSeries(); }
        function generateColorSeries() { engine.generateColorSeries(); }
        function generateHybridSeries() { engine.generateHybridSeries(); }
        function generateRandomSet() { engine.generateRandomSet(); }
        
        // Initialize
        window.addEventListener('load', () => {
            engine = new SensibleParametricEngine();
            
            // Load from URL parameters if present
            const urlParams = new URLSearchParams(window.location.search);
            Object.keys(engine.currentParams).forEach(key => {
                if (urlParams.has(key)) {
                    const value = urlParams.get(key);
                    engine.currentParams[key] = isNaN(value) ? value : parseFloat(value);
                }
            });
            
            engine.syncControlsWithParams();
            engine.updateDisplay();
        });
    </script>
</body>
</html>