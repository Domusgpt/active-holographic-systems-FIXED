<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Parametric Engine - Optimized Ranges & Units</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap');
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            background: #000;
            color: #fff;
            font-family: 'Orbitron', monospace;
            min-height: 100vh;
            background: radial-gradient(ellipse at center, #1a0033 0%, #000000 70%);
        }
        
        /* HEADER */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid #00ffff;
            padding: 15px 30px;
        }
        
        .header h1 {
            color: #00ffff;
            font-size: 1.3rem;
            text-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
        }
        
        .optimization-badge {
            display: inline-block;
            background: linear-gradient(45deg, #00ff00, #00ffff);
            color: #000;
            padding: 4px 8px;
            border-radius: 15px;
            font-size: 0.6rem;
            font-weight: bold;
            margin-left: 10px;
        }
        
        .header-controls {
            display: flex;
            gap: 15px;
            margin-top: 10px;
            flex-wrap: wrap;
        }
        
        .btn {
            background: rgba(0, 255, 255, 0.2);
            border: 1px solid #00ffff;
            color: #00ffff;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.7rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Orbitron', monospace;
        }
        
        .btn:hover {
            background: rgba(0, 255, 255, 0.4);
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
        }
        
        .btn.active {
            background: rgba(0, 255, 255, 0.6);
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.7);
        }
        
        /* MAIN LAYOUT */
        .main-container {
            display: grid;
            grid-template-columns: 380px 1fr 320px;
            height: 100vh;
            margin-top: 80px;
            gap: 20px;
            padding: 20px;
        }
        
        /* LEFT PANEL - PARAMETER CONTROLS */
        .control-panel {
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 15px;
            padding: 20px;
            overflow-y: auto;
            max-height: calc(100vh - 120px);
        }
        
        .control-section {
            margin-bottom: 25px;
        }
        
        .section-title {
            color: #00ffff;
            font-size: 0.9rem;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .parameter-control {
            margin-bottom: 25px;
            position: relative;
        }
        
        .param-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.8);
        }
        
        .param-name {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .param-unit {
            color: #ff0;
            font-size: 0.7rem;
            font-style: italic;
        }
        
        .param-value {
            color: #00ffff;
            font-weight: bold;
            font-size: 0.9rem;
        }
        
        .param-slider {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            outline: none;
            -webkit-appearance: none;
            cursor: pointer;
            margin-bottom: 8px;
        }
        
        .param-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            background: #00ffff;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 12px rgba(0, 255, 255, 0.6);
        }
        
        .param-slider::-moz-range-thumb {
            width: 18px;
            height: 18px;
            background: #00ffff;
            border-radius: 50%;
            cursor: pointer;
            border: none;
            box-shadow: 0 0 12px rgba(0, 255, 255, 0.6);
        }
        
        .param-range-info {
            display: flex;
            justify-content: space-between;
            font-size: 0.65rem;
            color: rgba(255, 255, 255, 0.4);
        }
        
        .param-tooltip {
            position: absolute;
            top: -35px;
            left: 0;
            background: rgba(0, 0, 0, 0.9);
            color: #00ffff;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.65rem;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
            z-index: 100;
        }
        
        .parameter-control:hover .param-tooltip {
            opacity: 1;
        }
        
        .optimization-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-left: 5px;
        }
        
        .optimization-indicator.optimized {
            background: #00ff00;
            box-shadow: 0 0 5px rgba(0, 255, 0, 0.5);
        }
        
        .optimization-indicator.improved {
            background: #ffff00;
            box-shadow: 0 0 5px rgba(255, 255, 0, 0.5);
        }
        
        .optimization-indicator.original {
            background: #ff6666;
            box-shadow: 0 0 5px rgba(255, 102, 102, 0.5);
        }
        
        .geometry-selector {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-bottom: 15px;
        }
        
        .geometry-btn {
            background: rgba(0, 255, 255, 0.1);
            border: 1px solid rgba(0, 255, 255, 0.3);
            color: rgba(255, 255, 255, 0.7);
            padding: 8px;
            border-radius: 8px;
            font-size: 0.6rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }
        
        .geometry-btn.active {
            background: rgba(0, 255, 255, 0.3);
            border-color: #00ffff;
            color: #00ffff;
        }
        
        /* CENTER PANEL - LIVE PREVIEW */
        .preview-panel {
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 15px;
            position: relative;
            overflow: hidden;
        }
        
        .preview-canvas {
            width: 100%;
            height: 100%;
            display: block;
        }
        
        .preview-overlay {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid rgba(0, 255, 255, 0.3);
        }
        
        .current-variant {
            color: #00ffff;
            font-size: 1.1rem;
            margin-bottom: 5px;
        }
        
        .variant-stats {
            font-size: 0.7rem;
            color: rgba(255, 255, 255, 0.6);
        }
        
        /* RIGHT PANEL - GENERATION TOOLS */
        .generation-panel {
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 15px;
            padding: 20px;
            overflow-y: auto;
            max-height: calc(100vh - 120px);
        }
        
        .generation-section {
            margin-bottom: 25px;
        }
        
        .generate-btn {
            width: 100%;
            background: linear-gradient(45deg, #00ffff, #ff00ff);
            border: none;
            color: #000;
            padding: 12px;
            border-radius: 10px;
            font-family: 'Orbitron', monospace;
            font-weight: bold;
            cursor: pointer;
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }
        
        .generate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 255, 255, 0.3);
        }
        
        .optimization-info {
            background: rgba(0, 255, 0, 0.1);
            border: 1px solid rgba(0, 255, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .optimization-info h3 {
            color: #00ff00;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }
        
        .optimization-info ul {
            list-style: none;
            padding: 0;
        }
        
        .optimization-info li {
            font-size: 0.7rem;
            margin-bottom: 5px;
            color: rgba(255, 255, 255, 0.8);
        }
        
        .optimization-info .improvement {
            color: #00ff00;
        }
        
        .optimization-info .warning {
            color: #ffff00;
        }
        
        /* RESPONSIVE */
        @media (max-width: 1200px) {
            .main-container {
                grid-template-columns: 320px 1fr 280px;
            }
        }
        
        @media (max-width: 900px) {
            .main-container {
                grid-template-columns: 1fr;
                grid-template-rows: auto 400px auto;
            }
            
            .control-panel, .generation-panel {
                max-height: none;
            }
        }
    </style>
</head>
<body>
    <!-- HEADER -->
    <div class="header">
        <h1>⚙️ Parametric Engine - Optimized Ranges & Units<span class="optimization-badge">✨ OPTIMIZED</span></h1>
        <div class="header-controls">
            <button class="btn" onclick="window.open('parametric-engine-original.html', '_blank')" style="background: rgba(255, 150, 0, 0.2); border-color: #ff9600; color: #ff9600;">📊 COMPARE ORIGINAL</button>
            <button class="btn" onclick="window.open('visual-fidelity-test.html', '_blank')" style="background: rgba(150, 255, 0, 0.2); border-color: #96ff00; color: #96ff00;">🔬 VISUAL TEST</button>
            <button class="btn" onclick="window.open('portfolio.html', '_blank')" style="background: rgba(255, 0, 150, 0.2); border-color: #ff0096; color: #ff0096;">🌌 PORTFOLIO</button>
            <button class="btn" onclick="exportVariation()">📤 EXPORT</button>
            <button class="btn" onclick="importVariation()">📥 IMPORT</button>
            <button class="btn" onclick="savePreset()">💾 SAVE PRESET</button>
            <button class="btn" onclick="shareURL()">🔗 SHARE URL</button>
            <button class="btn" onclick="launchFullscreen()">🚀 LAUNCH</button>
        </div>
    </div>
    
    <div class="main-container">
        <!-- LEFT PANEL - PARAMETER CONTROLS -->
        <div class="control-panel">
            <!-- OPTIMIZATION INFO -->
            <div class="optimization-info">
                <h3>🎯 OPTIMIZATION IMPROVEMENTS</h3>
                <ul>
                    <li><span class="improvement">✓ Density:</span> 0.2-2.5 (was 0.1-3.0)</li>
                    <li><span class="improvement">✓ Speed:</span> 0.1-1.5 (was 0.1-2.0)</li>
                    <li><span class="improvement">✓ Chaos:</span> 0.0-0.8 (was 0.0-1.0)</li>
                    <li><span class="improvement">✓ Saturation:</span> 0.3-1.0 (was 0.0-1.0)</li>
                    <li><span class="improvement">✓ Intensity:</span> 0.2-0.9 (was 0.1-1.0)</li>
                    <li><span class="warning">⚠ Units:</span> Added proper markings</li>
                </ul>
            </div>
            
            <!-- GEOMETRY SELECTION -->
            <div class="control-section">
                <div class="section-title">Base Geometry</div>
                <div class="geometry-selector">
                    <div class="geometry-btn active" data-geometry="0">TETRAHEDRON</div>
                    <div class="geometry-btn" data-geometry="1">HYPERCUBE</div>
                    <div class="geometry-btn" data-geometry="2">SPHERE</div>
                    <div class="geometry-btn" data-geometry="3">TORUS</div>
                    <div class="geometry-btn" data-geometry="4">KLEIN</div>
                    <div class="geometry-btn" data-geometry="5">FRACTAL</div>
                    <div class="geometry-btn" data-geometry="6">WAVE</div>
                    <div class="geometry-btn" data-geometry="7">CRYSTAL</div>
                </div>
            </div>
            
            <!-- CORE PARAMETERS -->
            <div class="control-section">
                <div class="section-title">Core Parameters</div>
                
                <!-- DENSITY - OPTIMIZED -->
                <div class="parameter-control">
                    <div class="param-tooltip">Particle density multiplier - controls visual complexity</div>
                    <div class="param-label">
                        <div class="param-name">
                            <span>Density</span>
                            <span class="param-unit">[× multiplier]</span>
                            <span class="optimization-indicator optimized" title="Optimized range"></span>
                        </div>
                        <span class="param-value" id="densityValue">1.0×</span>
                    </div>
                    <input type="range" class="param-slider" id="densitySlider" min="0.2" max="2.5" step="0.1" value="1.0">
                    <div class="param-range-info">
                        <span>0.2× (sparse)</span>
                        <span>2.5× (dense)</span>
                    </div>
                </div>
                
                <!-- SPEED - OPTIMIZED -->
                <div class="parameter-control">
                    <div class="param-tooltip">Animation speed - controls rotation/movement rate</div>
                    <div class="param-label">
                        <div class="param-name">
                            <span>Speed</span>
                            <span class="param-unit">[cycles/sec]</span>
                            <span class="optimization-indicator optimized" title="Optimized range"></span>
                        </div>
                        <span class="param-value" id="speedValue">0.5 c/s</span>
                    </div>
                    <input type="range" class="param-slider" id="speedSlider" min="0.1" max="1.5" step="0.05" value="0.5">
                    <div class="param-range-info">
                        <span>0.1 (slow)</span>
                        <span>1.5 (fast)</span>
                    </div>
                </div>
                
                <!-- CHAOS - OPTIMIZED -->
                <div class="parameter-control">
                    <div class="param-tooltip">Turbulence factor - adds randomness to geometry</div>
                    <div class="param-label">
                        <div class="param-name">
                            <span>Chaos</span>
                            <span class="param-unit">[% turbulence]</span>
                            <span class="optimization-indicator optimized" title="Optimized range"></span>
                        </div>
                        <span class="param-value" id="chaosValue">0%</span>
                    </div>
                    <input type="range" class="param-slider" id="chaosSlider" min="0.0" max="0.8" step="0.02" value="0.0">
                    <div class="param-range-info">
                        <span>0% (ordered)</span>
                        <span>80% (chaotic)</span>
                    </div>
                </div>
                
                <!-- MORPHING - UNCHANGED -->
                <div class="parameter-control">
                    <div class="param-tooltip">Geometry blending - morphs between shapes</div>
                    <div class="param-label">
                        <div class="param-name">
                            <span>Morphing</span>
                            <span class="param-unit">[% blend]</span>
                            <span class="optimization-indicator original" title="Original range"></span>
                        </div>
                        <span class="param-value" id="morphValue">0%</span>
                    </div>
                    <input type="range" class="param-slider" id="morphSlider" min="0.0" max="1.0" step="0.05" value="0.0">
                    <div class="param-range-info">
                        <span>0% (pure)</span>
                        <span>100% (morphed)</span>
                    </div>
                </div>
            </div>
            
            <!-- COLOR SYSTEM -->
            <div class="control-section">
                <div class="section-title">Color System</div>
                
                <!-- HUE - PERFECT -->
                <div class="parameter-control">
                    <div class="param-tooltip">Color wheel position - 0°=Red, 120°=Green, 240°=Blue</div>
                    <div class="param-label">
                        <div class="param-name">
                            <span>Hue Shift</span>
                            <span class="param-unit">[degrees]</span>
                            <span class="optimization-indicator original" title="Perfect range"></span>
                        </div>
                        <span class="param-value" id="hueValue">0°</span>
                    </div>
                    <input type="range" class="param-slider" id="hueSlider" min="0" max="360" step="15" value="0">
                    <div class="param-range-info">
                        <span>0° (red)</span>
                        <span>360° (red)</span>
                    </div>
                </div>
                
                <!-- SATURATION - OPTIMIZED -->
                <div class="parameter-control">
                    <div class="param-tooltip">Color intensity - higher values = more vivid colors</div>
                    <div class="param-label">
                        <div class="param-name">
                            <span>Saturation</span>
                            <span class="param-unit">[% intensity]</span>
                            <span class="optimization-indicator optimized" title="Optimized range"></span>
                        </div>
                        <span class="param-value" id="saturationValue">80%</span>
                    </div>
                    <input type="range" class="param-slider" id="saturationSlider" min="0.3" max="1.0" step="0.05" value="0.8">
                    <div class="param-range-info">
                        <span>30% (muted)</span>
                        <span>100% (vivid)</span>
                    </div>
                </div>
                
                <!-- INTENSITY - OPTIMIZED -->
                <div class="parameter-control">
                    <div class="param-tooltip">Overall brightness - prevents too dark/bright extremes</div>
                    <div class="param-label">
                        <div class="param-name">
                            <span>Intensity</span>
                            <span class="param-unit">[% brightness]</span>
                            <span class="optimization-indicator optimized" title="Optimized range"></span>
                        </div>
                        <span class="param-value" id="intensityValue">50%</span>
                    </div>
                    <input type="range" class="param-slider" id="intensitySlider" min="0.2" max="0.9" step="0.05" value="0.5">
                    <div class="param-range-info">
                        <span>20% (dim)</span>
                        <span>90% (bright)</span>
                    </div>
                </div>
            </div>
            
            <!-- AUDIO REACTIVITY -->
            <div class="control-section">
                <div class="section-title">Audio Reactivity</div>
                
                <!-- BASS RESPONSE - PERFECT -->
                <div class="parameter-control">
                    <div class="param-tooltip">Bass frequency sensitivity - 0×=off, 1×=normal, 2×=sensitive</div>
                    <div class="param-label">
                        <div class="param-name">
                            <span>Bass Response</span>
                            <span class="param-unit">[× sensitivity]</span>
                            <span class="optimization-indicator original" title="Perfect range"></span>
                        </div>
                        <span class="param-value" id="bassValue">1.0×</span>
                    </div>
                    <input type="range" class="param-slider" id="bassSlider" min="0.0" max="2.0" step="0.1" value="1.0">
                    <div class="param-range-info">
                        <span>0× (off)</span>
                        <span>2× (sensitive)</span>
                    </div>
                </div>
                
                <!-- MID RESPONSE - PERFECT -->
                <div class="parameter-control">
                    <div class="param-tooltip">Mid frequency sensitivity - vocals and instruments</div>
                    <div class="param-label">
                        <div class="param-name">
                            <span>Mid Response</span>
                            <span class="param-unit">[× sensitivity]</span>
                            <span class="optimization-indicator original" title="Perfect range"></span>
                        </div>
                        <span class="param-value" id="midValue">1.0×</span>
                    </div>
                    <input type="range" class="param-slider" id="midSlider" min="0.0" max="2.0" step="0.1" value="1.0">
                    <div class="param-range-info">
                        <span>0× (off)</span>
                        <span>2× (sensitive)</span>
                    </div>
                </div>
                
                <!-- HIGH RESPONSE - PERFECT -->
                <div class="parameter-control">
                    <div class="param-tooltip">High frequency sensitivity - cymbals and treble</div>
                    <div class="param-label">
                        <div class="param-name">
                            <span>High Response</span>
                            <span class="param-unit">[× sensitivity]</span>
                            <span class="optimization-indicator original" title="Perfect range"></span>
                        </div>
                        <span class="param-value" id="highValue">1.0×</span>
                    </div>
                    <input type="range" class="param-slider" id="highSlider" min="0.0" max="2.0" step="0.1" value="1.0">
                    <div class="param-range-info">
                        <span>0× (off)</span>
                        <span>2× (sensitive)</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- CENTER PANEL - LIVE PREVIEW -->
        <div class="preview-panel">
            <iframe class="preview-canvas" id="previewIframe" 
                    src="demo-modular.html?hideui=true&noaudio=true&geometry=0&density=1.0&speed=0.5&chaos=0.0&morph=0.0&hue=0&saturation=0.8&intensity=0.5"
                    style="border: none; width: 100%; height: 100%; background: #000;"></iframe>
            <div class="preview-overlay">
                <div class="current-variant" id="currentVariant">OPTIMIZED VARIATION</div>
                <div class="variant-stats" id="variantStats">
                    Geometry: TETRAHEDRON • Complexity: ★★☆☆☆ • Optimized: ✓
                </div>
            </div>
        </div>
        
        <!-- RIGHT PANEL - GENERATION TOOLS -->
        <div class="generation-panel">
            <!-- SYSTEMATIC GENERATION -->
            <div class="generation-section">
                <div class="section-title">Systematic Generation</div>
                <button class="generate-btn" onclick="generateDensitySeries()">DENSITY SERIES (5x)</button>
                <button class="generate-btn" onclick="generateSpeedSeries()">SPEED SERIES (5x)</button>
                <button class="generate-btn" onclick="generateChaosSeries()">CHAOS SERIES (5x)</button>
                <button class="generate-btn" onclick="generateColorSeries()">COLOR SERIES (6x)</button>
                <button class="generate-btn" onclick="generateHybridSeries()">HYBRID SERIES (4x)</button>
                <button class="generate-btn" onclick="generateRandomSet()">RANDOM SET (10x)</button>
            </div>
            
            <!-- BATCH OPERATIONS -->
            <div class="generation-section">
                <div class="section-title">Batch Operations</div>
                <button class="generate-btn" onclick="engine.generateBatch()" style="background: linear-gradient(45deg, #00ff00, #00ffff);">📦 EXPORT BATCH</button>
                <button class="generate-btn" onclick="engine.generatePortfolioUpdate()" style="background: linear-gradient(45deg, #ff00ff, #00ffff);">🎨 PORTFOLIO UPDATE</button>
                <button class="generate-btn" onclick="engine.clearQueue()" style="background: linear-gradient(45deg, #ff4757, #ff6b9d);">🗑️ CLEAR QUEUE</button>
            </div>
            
            <!-- OPTIMIZATION DETAILS -->
            <div class="generation-section">
                <div class="section-title">Optimization Details</div>
                <div style="font-size: 0.7rem; color: rgba(255,255,255,0.8);">
                    <p><strong>Range Improvements:</strong></p>
                    <ul style="margin: 10px 0; padding-left: 15px;">
                        <li>Density: Eliminated imperceptible low values</li>
                        <li>Speed: Reduced motion sickness at high values</li>
                        <li>Chaos: Prevented geometry destruction</li>
                        <li>Saturation: Maintained holographic effect</li>
                        <li>Intensity: Prevented eye strain</li>
                    </ul>
                    <p><strong>Unit Markings:</strong></p>
                    <ul style="margin: 10px 0; padding-left: 15px;">
                        <li>Clear physical meanings</li>
                        <li>Percentage indicators</li>
                        <li>Multiplier notation</li>
                        <li>Helpful tooltips</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        // OPTIMIZED PARAMETRIC ENGINE SYSTEM
        class OptimizedParametricEngine {
            constructor() {
                this.currentParams = {
                    geometry: 0,
                    density: 1.0,
                    speed: 0.5,
                    chaos: 0.0,
                    morph: 0.0,
                    hue: 0,
                    saturation: 0.8,
                    intensity: 0.5,
                    bassResponse: 1.0,
                    midResponse: 1.0,
                    highResponse: 1.0
                };
                
                this.geometryNames = [
                    'TETRAHEDRON', 'HYPERCUBE', 'SPHERE', 'TORUS',
                    'KLEIN BOTTLE', 'FRACTAL', 'WAVE', 'CRYSTAL'
                ];
                
                this.generatedVariations = [];
                this.presets = this.loadPresets();
                
                this.init();
            }
            
            init() {
                this.setupControls();
                this.setupPreview();
                this.updateDisplay();
                this.startPreviewAnimation();
            }
            
            setupControls() {
                // Geometry selection
                document.querySelectorAll('.geometry-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        document.querySelectorAll('.geometry-btn').forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');
                        this.currentParams.geometry = parseInt(btn.dataset.geometry);
                        this.updateDisplay();
                    });
                });
                
                // Parameter sliders with optimized ranges
                this.setupSlider('density', 'densityValue', 'densitySlider', '×');
                this.setupSlider('speed', 'speedValue', 'speedSlider', ' c/s');
                this.setupSlider('chaos', 'chaosValue', 'chaosSlider', '%', 100);
                this.setupSlider('morph', 'morphValue', 'morphSlider', '%', 100);
                this.setupSlider('hue', 'hueValue', 'hueSlider', '°');
                this.setupSlider('saturation', 'saturationValue', 'saturationSlider', '%', 100);
                this.setupSlider('intensity', 'intensityValue', 'intensitySlider', '%', 100);
                this.setupSlider('bassResponse', 'bassValue', 'bassSlider', '×');
                this.setupSlider('midResponse', 'midValue', 'midSlider', '×');
                this.setupSlider('highResponse', 'highValue', 'highSlider', '×');
            }
            
            setupSlider(param, valueId, sliderId, suffix = '', multiplier = 1) {
                const slider = document.getElementById(sliderId);
                const valueDisplay = document.getElementById(valueId);
                
                slider.addEventListener('input', (e) => {
                    const value = parseFloat(e.target.value);
                    this.currentParams[param] = value;
                    
                    // Format display value with proper units
                    let displayValue = value;
                    if (multiplier > 1) {
                        displayValue = Math.round(value * multiplier);
                    } else if (suffix === '×' || suffix === ' c/s') {
                        displayValue = value.toFixed(1);
                    } else if (suffix === '°') {
                        displayValue = Math.round(value);
                    }
                    
                    valueDisplay.textContent = displayValue + suffix;
                    this.updateDisplay();
                });
                
                // Initialize display
                let initialValue = this.currentParams[param];
                if (multiplier > 1) {
                    initialValue = Math.round(initialValue * multiplier);
                } else if (suffix === '×' || suffix === ' c/s') {
                    initialValue = initialValue.toFixed(1);
                } else if (suffix === '°') {
                    initialValue = Math.round(initialValue);
                }
                valueDisplay.textContent = initialValue + suffix;
            }
            
            setupPreview() {
                this.previewIframe = document.getElementById('previewIframe');
                this.updatePreview();
            }
            
            updateDisplay() {
                const geometryName = this.geometryNames[this.currentParams.geometry];
                const complexity = this.calculateComplexity();
                
                document.getElementById('currentVariant').textContent = 
                    `OPTIMIZED ${geometryName}`;
                    
                document.getElementById('variantStats').innerHTML = 
                    `Geometry: ${geometryName} • Complexity: ${'★'.repeat(complexity)}${'☆'.repeat(5-complexity)} • Optimized: ✓`;
                
                // Update live preview
                this.updatePreview();
            }
            
            updatePreview() {
                const params = new URLSearchParams();
                params.set('hideui', 'true');
                params.set('noaudio', 'true');
                Object.keys(this.currentParams).forEach(key => {
                    params.set(key, this.currentParams[key]);
                });
                
                const newSrc = `demo-modular.html?${params.toString()}`;
                if (this.previewIframe && this.previewIframe.src !== newSrc) {
                    this.previewIframe.src = newSrc;
                }
            }
            
            calculateComplexity(variation) {
                if (!variation) variation = this.currentParams;
                const { density, speed, chaos, morph } = variation;
                const complexityScore = (density + speed + chaos * 2 + morph * 2) / 6;
                return Math.min(5, Math.max(1, Math.round(complexityScore * 5)));
            }
            
            startPreviewAnimation() {
                // Preview iframe handles animation automatically
            }
            
            // GENERATION METHODS (using optimized ranges)
            generateDensitySeries() {
                const baseName = this.geometryNames[this.currentParams.geometry];
                const densityLevels = [0.2, 0.5, 1.0, 1.5, 2.0]; // Optimized range
                
                densityLevels.forEach((density, index) => {
                    const variation = {
                        ...this.currentParams,
                        density: density,
                        name: `${baseName} DENSITY ${index + 1}`,
                        id: this.generatedVariations.length
                    };
                    this.addToQueue(variation);
                });
            }
            
            generateSpeedSeries() {
                const baseName = this.geometryNames[this.currentParams.geometry];
                const speedLevels = [0.1, 0.4, 0.7, 1.0, 1.3]; // Optimized range
                
                speedLevels.forEach((speed, index) => {
                    const variation = {
                        ...this.currentParams,
                        speed: speed,
                        name: `${baseName} SPEED ${index + 1}`,
                        id: this.generatedVariations.length
                    };
                    this.addToQueue(variation);
                });
            }
            
            generateChaosSeries() {
                const baseName = this.geometryNames[this.currentParams.geometry];
                const chaosLevels = [0.0, 0.2, 0.4, 0.6, 0.8]; // Optimized range
                
                chaosLevels.forEach((chaos, index) => {
                    const variation = {
                        ...this.currentParams,
                        chaos: chaos,
                        name: `${baseName} CHAOS ${index + 1}`,
                        id: this.generatedVariations.length
                    };
                    this.addToQueue(variation);
                });
            }
            
            generateColorSeries() {
                const baseName = this.geometryNames[this.currentParams.geometry];
                const hueShifts = [0, 60, 120, 180, 240, 300];
                
                hueShifts.forEach((hue, index) => {
                    const variation = {
                        ...this.currentParams,
                        hue: hue,
                        name: `${baseName} HUE ${hue}°`,
                        id: this.generatedVariations.length
                    };
                    this.addToQueue(variation);
                });
            }
            
            generateHybridSeries() {
                const baseName = this.geometryNames[this.currentParams.geometry];
                const hybrids = [
                    { density: 0.8, speed: 0.6, chaos: 0.2, name: 'BALANCED' },
                    { density: 1.5, speed: 1.0, chaos: 0.4, name: 'ENERGETIC' },
                    { density: 0.5, speed: 0.3, chaos: 0.6, name: 'CALM CHAOS' },
                    { density: 2.0, speed: 1.2, chaos: 0.1, name: 'DENSE MOTION' }
                ];
                
                hybrids.forEach((hybrid, index) => {
                    const variation = {
                        ...this.currentParams,
                        ...hybrid,
                        name: `${baseName} ${hybrid.name}`,
                        id: this.generatedVariations.length
                    };
                    this.addToQueue(variation);
                });
            }
            
            addToQueue(variation) {
                this.generatedVariations.push(variation);
                console.log(`Generated: ${variation.name}`);
            }
            
            clearQueue() {
                this.generatedVariations = [];
                console.log('Queue cleared');
            }
            
            generateBatch() {
                console.log('Generating batch export...');
                // Implementation for batch export
            }
            
            generatePortfolioUpdate() {
                console.log('Updating portfolio...');
                // Implementation for portfolio update
            }
            
            loadPresets() {
                return {};
            }
            
            syncControlsWithParams() {
                // Sync all controls with current parameters
                Object.keys(this.currentParams).forEach(key => {
                    const element = document.getElementById(key + 'Slider');
                    if (element) {
                        element.value = this.currentParams[key];
                    }
                });
                this.updateDisplay();
            }
            
            launchFullscreen() {
                const params = new URLSearchParams();
                Object.keys(this.currentParams).forEach(key => {
                    params.set(key, this.currentParams[key]);
                });
                
                window.open(`demo-modular.html?${params.toString()}`, '_blank');
            }
        }
        
        // Global functions for buttons
        function exportVariation() { console.log('Export variation'); }
        function importVariation() { console.log('Import variation'); }
        function savePreset() { console.log('Save preset'); }
        function shareURL() { console.log('Share URL'); }
        function launchFullscreen() { engine.launchFullscreen(); }
        
        function generateDensitySeries() { engine.generateDensitySeries(); }
        function generateSpeedSeries() { engine.generateSpeedSeries(); }
        function generateChaosSeries() { engine.generateChaosSeries(); }
        function generateColorSeries() { engine.generateColorSeries(); }
        function generateHybridSeries() { engine.generateHybridSeries(); }
        
        function generateRandomSet() {
            const baseName = engine.geometryNames[engine.currentParams.geometry];
            
            for (let i = 0; i < 10; i++) {
                const variation = {
                    ...engine.currentParams,
                    density: 0.5 + Math.random() * 2.0,    // Optimized range
                    speed: 0.2 + Math.random() * 1.3,     // Optimized range
                    chaos: Math.random() * 0.8,           // Optimized range
                    morph: Math.random(),
                    hue: Math.floor(Math.random() * 360),
                    saturation: 0.3 + Math.random() * 0.7, // Optimized range
                    intensity: 0.2 + Math.random() * 0.7,  // Optimized range
                    name: `${baseName} RANDOM ${i + 1}`,
                    id: engine.generatedVariations.length
                };
                engine.addToQueue(variation);
            }
        }
        
        function exportSingleVariation(id) { console.log('Export single:', id); }
        function removeFromQueue(id) { console.log('Remove from queue:', id); }
        
        function previewVariation(id) {
            const variation = engine.generatedVariations[id];
            if (variation) {
                engine.currentParams = {...variation};
                engine.syncControlsWithParams();
                engine.updateDisplay();
            }
        }
        
        // Initialize
        const engine = new OptimizedParametricEngine();
        
        // Load from URL parameters if present
        window.addEventListener('load', () => {
            const urlParams = new URLSearchParams(window.location.search);
            
            Object.keys(engine.currentParams).forEach(key => {
                if (urlParams.has(key)) {
                    const value = urlParams.get(key);
                    engine.currentParams[key] = isNaN(value) ? value : parseFloat(value);
                }
            });
            
            engine.syncControlsWithParams();
            engine.updateDisplay();
        });
    </script>
</body>
</html>